---
import BaseLayout from "../layouts/BaseLayout.astro";
import NewsletterSignup from "../components/NewsletterSignup.astro";
import { loadDigests } from "../data/load-digests.ts";
// Sort digests by date (newest first) and prepare recent slice
const digests = await loadDigests();
const sortedDigests = digests.slice().sort((a, b) => {
  const aDate = new Date(a.date).getTime();
  const bDate = new Date(b.date).getTime();
  return bDate - aDate;
});
const recentDigests = sortedDigests.slice(0, 5);
---
<BaseLayout title="Digests â€“ Backporting.ai" description="Periodic digests for patch backporting automation.">
  <div class="prose max-w-none">
    <h1>Digests</h1>
    <p>Periodic roundups with highlights and commentary.</p>
  </div>

  <section class="mt-8">
    <NewsletterSignup />
  </section>

  <section class="mt-8">
    <h2 class="sr-only">Recent digests</h2>
    <div class="overflow-x-auto">
      <ul class={`flex gap-4 pb-2 ${recentDigests.length <= 3 ? 'justify-center' : 'min-w-max'}`}>
        {recentDigests.map((d) => (
          <li class="w-72 shrink-0">
            <a href={`${import.meta.env.BASE_URL}digests/${d.slug}`} class="block h-full rounded-xl border border-slate-200 bg-white p-4 hover:shadow-sm transition">
              <div class="flex items-baseline justify-between gap-3">
                <div class="font-medium">{d.title}</div>
                <div class="text-xs text-slate-500 text-right">
                  <div>No. {d.number}</div>
                  <time datetime={d.date}>{d.date}</time>
                </div>
              </div>
              <p class="mt-2 text-sm text-slate-700">{d.summary || "No summary provided"}</p>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </section>

  <section class="mt-10">
    <h2 class="text-base font-semibold">All digests</h2>
    <ul class="mt-4 divide-y">
      {sortedDigests.map((d) => (
        <li class="py-4">
          <div class="flex items-baseline justify-between gap-3">
            <a href={`${import.meta.env.BASE_URL}digests/${d.slug}`} class="font-medium hover:underline">
              {d.title}
            </a>
            <div class="text-xs text-slate-500 flex items-center gap-3">
              <span>No. {d.number}</span>
              <time datetime={d.date}>{d.date}</time>
            </div>
          </div>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>


