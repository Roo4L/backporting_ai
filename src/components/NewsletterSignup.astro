---
// NewsletterSignup component for subscribing to digest emails
---

<div class="newsletter-signup rounded-2xl border border-slate-200 bg-gradient-to-br from-slate-50 to-slate-100 p-6 sm:p-8 max-w-2xl mx-auto">
  <div class="max-w-2xl">
    <h3 class="text-xl sm:text-2xl font-semibold text-slate-900 text-center">Get digest updates</h3>
    <p class="mt-2 text-sm sm:text-base text-slate-600 text-center">
      Subscribe to receive our periodic digests on patch backporting automation directly in your inbox.
    </p>
    
    <form id="newsletter-form" class="mt-4 flex flex-col sm:flex-row gap-3">
      <div class="flex-1">
        <label for="email" class="sr-only">Email address</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="your@email.com"
          class="w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-slate-900 placeholder-slate-400 focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-500/20"
        />
      </div>
      <button
        type="submit"
        class="rounded-lg bg-sky-600 px-6 py-2.5 font-medium text-white hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 transition disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Subscribe
      </button>
    </form>
    
    <div id="newsletter-message" class="mt-3 text-sm hidden text-center"></div>
  </div>
</div>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const emailInput = document.getElementById('email') as HTMLInputElement;
  const messageDiv = document.getElementById('newsletter-message') as HTMLDivElement;
  const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = emailInput.value.trim();
    
    // Basic email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showMessage('Please enter a valid email address.', 'error');
      return;
    }
    
    // Disable form during submission
    submitButton.disabled = true;
    submitButton.textContent = 'Subscribing...';
    messageDiv.classList.add('hidden');
    
    try {
      const response = await fetch('/api/subscribe', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email }),
      });
      
      const data = await response.json();
      
      if (response.ok) {
        showMessage(data.message || 'Successfully subscribed! Check your email to confirm.', 'success');
        emailInput.value = '';
      } else {
        showMessage(data.error || 'Failed to subscribe. Please try again.', 'error');
      }
    } catch (error) {
      showMessage('An error occurred. Please try again later.', 'error');
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = 'Subscribe';
    }
  });
  
  function showMessage(message: string, type: 'success' | 'error') {
    messageDiv.textContent = message;
    messageDiv.classList.remove('hidden', 'text-green-700', 'text-red-700');
    
    if (type === 'success') {
      messageDiv.classList.add('text-green-700');
    } else {
      messageDiv.classList.add('text-red-700');
    }
  }
</script>







